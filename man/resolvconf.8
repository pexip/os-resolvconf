.TH RESOLVCONF "8" "6 Dec 2011" "resolvconf" "resolvconf"
.SH NAME
resolvconf \- manage nameserver information
.SH SYNOPSIS
cat \fIFILE\fR |
.B resolvconf
\fB\-a\fR \fIIFACE.PROG\fR
.PP
.B resolvconf
\fB\-d\fR \fIIFACE.PROG\fR
.PP
.B resolvconf
\fB\-u\fR
.PP
.B resolvconf
.B \-\-enable\-updates
|
.B \-\-disable\-updates
|
.B \-\-updates\-are\-enabled
|
.B \-\-create\-runtime\-directories
|
.B \-\-wipe\-runtime\-directories
.SH DESCRIPTION
Overwrite (\fB\-a\fR) or delete (\fB\-d\fR) the nameserver information
record \fIIFACE.PROG\fR.
Also run the update scripts in \fI/etc/resolvconf/update.d/\fR
if the nameserver information has changed
and updating is enabled.
.PP
With \fB\-u\fR, just run the update scripts
if updating is enabled.
.PP
With \fB\-a\fR, \fB\-d\fR or \fB\-u\fR
schedule a delayed update if updating is not currently enabled.
.SH PUBLICATION
Normally
.B resolvconf
is run only by hook scripts attached to network interface configurers
such as
.BR pppd (8) 
(for ppp interfaces),
to DHCP clients such as
.BR dhclient (8),
to
.BR ifup (8) 
and
.BR ifdown ,
and
to DNS caches such as
.BR dnsmasq (8)
(for the loopback interface).
These hook scripts furnish
.B resolvconf
with information about nameservers.
For example,
.B dhclient
receives one or more nameserver addresses
during its negotiation with the DHCP server;
its hook script
.I /etc/dhcp/dhclient-enter-hooks.d/resolvconf
pushes this information to 
.B resolvconf.
.PP
The
.BR ifup (8)
program can be used to configure network interfaces
according to settings in
.IR /etc/network/interfaces (5).
To make 
.B ifup
push nameserver information to
.B resolvconf
when it configures an interface, add
.B dns\-
lines to the relevant
.B iface
stanza in
.IR /etc/network/interfaces .
To add nameserver addresses add a line beginning with
.BR dns\-nameservers .
.PP
.EX
    dns\-nameservers 11.22.33.44 55.66.77.88
.EE
.PP
Note that one or more addresses can be given,
and note the `s' at the end of the option name.
(Contrast with the 
.BR resolv.conf (5)
option
.BR nameserver .)
For each other valid
.BR resolv.conf (5)
configuration option,
you can include, in the stanza,
one line beginning with that option name with a
.B dns\-
prefix.
The resulting stanza might look like the following example.
.PP
.EX
    iface eth0 inet static
        address 192.168.3.3
        netmask 255.255.255.0
        gateway 192.168.3.1
        dns\-nameservers 192.168.3.45 192.168.8.10
        dns\-search foo.org bar.com
.EE
.PP
See the resolvconf package's
.I README
file for more detailed information.
For more information about the dns-* options, e.g.,
.BR dns\-search ,
see
.BR resolv.conf (5).
.PP
The administrator \fIcan\fR run
.B resolvconf
from the command line to add or delete nameserver information,
but this is not normally necessary.
.SH SUBSCRIPTION
Nameserver information provided to
.B resolvconf
is stored for use by subscribers to \fBresolvconf\fR's notification service.
Subscribers that need to know when nameserver information has changed
should install a script in
.I /etc/resolvconf/update.d/
(or in
.IR /etc/resolvconf/update-libc.d/ :
see below).
For example, DNS caches such as
.BR dnsmasq (8)
and
.BR pdnsd (8)
subscribe to the notification service so that they know
whither to forward queries.
.PP
The most important piece of
software that subscribes to the notification service is the set of functions
that make up the GNU C Library
.IR resolver (3).
When nameserver information is updated, the script
.I /etc/resolvconf/update.d/libc
writes a new resolver configuration file to
.I /run/resolvconf/resolv.conf
and then runs the scripts in
.IR /etc/resolvconf/update-libc.d/ .
To make the resolver use the dynamically generated resolver configuration
file the administrator should ensure that
.I /etc/resolv.conf
is a symbolic link to
.IR /run/resolvconf/resolv.conf .
This link is never modified by
.BR resolvconf (8).
If you find that \fI/etc/resolv.conf\fR is not being updated,
check to make sure that the link is intact.
.PP
The GNU C Library resolver library isn't the only resolver library available.
However, any resolver library that reads
.I /etc/resolv.conf
(and most of them do, in order to be compatible with the GNU C Library resolver)
should work with
.BR resolvconf (8).
.PP
Subscribers that need to know only when the resolver configuration file
has changed should install a script in
.I /etc/resolvconf/update-libc.d/
rather than in
.IR /etc/resolvconf/update.d/ .
This is important for synchronization purposes:
scripts in
.I update-libc.d/
are run \fIafter\fR
.I resolv.conf
has been updated;
the same is not necessarily true of scripts in
.IR update.d/ .
Examples of packages that do this are
.BR fetchmail (1)
and
.BR squid (8).
.PP
Client hook scripts will find the files containing nameserver
information in the current directory.
.SH OPTIONS
.TP
\fB\-a\fR \fIIFACE.PROG\fR
Add or overwrite the record \fIIFACE.PROG\fR.
When this option is used the information must be provided to
.B resolvconf
on its standard input in the format of the
.BR resolv.conf (5)
file.
Each line in the file must be terminated by a newline.
.TP
\fB\-d\fR \fIIFACE.PROG\fR
Delete the record \fIIFACE.PROG\fR.
.PP
The string \fIIFACE.PROG\fR name may not contain
spaces,
slashes,
an initial dot, an initial hyphen or an initial tilde.
It is conventionally formed from
\fIIFACE\fR,
the name of the interface involved,
a dot,
and
\fIPROG\fR,
the name of the interface configuration program,
e.g., `eth0.dhclient'.
.PP
Following the addition or deletion of the record,
run the update scripts
(if updating is enabled).
.TP
\fB\-u\fR
Just run the update scripts
(if updating is enabled).
.TP
\fB\-\-enable\-updates\fR 
Set the flag indicating that 
.B resolvconf
should run update scripts
when invoked in the future with \fB\-a\fR, \fB\-d\fR or \fB\-u\fR.
If a delayed update was scheduled then run update scripts.
.TP
\fB\-\-disable\-updates\fR
Clear the flag.
.TP
\fB\-\-updates\-are\-enabled\fR
Return 0 if the flag is set,
otherwise return 1.
.TP
\fB\-\-create\-runtime\-directories\fR
Create the directories where resolver information records
and other run-time files are stored.
.TP
\fB\-\-wipe\-runtime\-directories\fR
Delete everything in the directories where resolver information records
and other run-time files are stored.
.SH ENVIRONMENT VARIABLES
The following variables can be set in the default-override file
.IR /etc/default/resolvconf .
If the file does not exist you will have to create it.
.TP
.B REPORT_ABSENT_SYMLINK
If set to "yes" then
.B resolvconf
will print a message when
.I /etc/resolv.conf
is not a symbolic link
to the
.BR resolvconf (8)-generated
.I resolv.conf
file.
Set to "no" to prevent the printing of this message.
The default is "yes".
.TP
.B TRUNCATE_NAMESERVER_LIST_AFTER_LOOPBACK_ADDRESS
If set to "yes" then the 
.I update.d/libc
script will include
no more nameserver addresses after the first loopback address.
In IPv4 a loopback address is an address that starts with "127."
This is usually the preferable behavior
if the nameserver at 127.* is a local caching nameserver
since it inhibits unnecessary changes to
.IR resolv.conf .
When an interface is brought up
the local caching nameserver is informed by
.BR resolvconf (8)
of any new nameserver addresses
and the additional name service is made available to applications
that make use of the resolver and the local caching nameserver;
the applications themselves do not need to be notified of the change.
A disadvantage of this mode of operation is that applications have
no secondary or tertiary nameserver address to fall back on should
the local caching nameserver crash.
Insofar as a local nameserver crash can be regarded
as an unlikely event,
this is a relatively minor disadvantage.
Set to "no" to disable this truncation feature.
The default is "yes".
A deprecated synonym for this variable is 
.BR TRUNCATE_NAMESERVER_LIST_AFTER_127 .
.SH FILES
.TP
.I /etc/default/resolvconf
See the ENVIRONMENT VARIABLES section.
.TP
.I /run/resolvconf
This is the location where nameserver information is stored.
It will be created if
.B resolvconf
is called with the
\fB\-\-create\-runtime\-directories\fR option.
Clients should not make any assumptions about the hierarchy that is
constructed under this directory.
.TP
.I /etc/resolvconf/interface-order
Determines the order in which nameserver information records are processed.
See
.BR interface-order (5).
.TP
.I /etc/resolvconf/resolv.conf.d/base
File containing basic resolver information.
The lines in this file are included in the resolver configuration file
even when no interfaces are configured.
.TP
.I /etc/resolvconf/resolv.conf.d/head
File to be prepended to the dynamically generated resolver configuration file.
Normally this is just a comment line.
.TP
.I /etc/resolvconf/resolv.conf.d/tail
File to be appended to the dynamically generated resolver configuration file.
To append nothing, make this an empty file.
This file is a good place to put a resolver
.B options
line if one is needed, e.g.,

.EX
    options inet6
.EE
.TP
.I /etc/resolvconf/resolv.conf.d/original
Copy of the \fI/etc/resolv.conf\fR file before the resolvconf package was installed.
This file has no effect on the functioning of resolvconf;
it is retained so that \fI/etc/resolv.conf\fR can be restored
to its original state if the resolvconf package if removed.

Note also that a copy of this file is included in the database
until the first reboot after installation of the resolvconf package;
this ensures that nameservers reachable before installation of resolvconf
are still reachable after installation of resolvconf even though
at that point
not all suppliers of nameserver information may have supplied their
information to
.BR resolvconf (8).

Note also that the administrator can choose to create a symbolic link
in \fI/etc/resolvconf/resolv.conf.d/\fR from
.I tail
to
.I original
so that the contents of the latter are always added to the end of the
dynamically generated \fIresolv.conf\fR.

.SH BUGS
Currently
.B resolvconf
does not check the sanity of the information provided to it.
.SH AUTHOR
Written by Thomas Hood <jdthood@gmail.com>.
.SH COPYRIGHT
Copyright \(co 2004, 2011 Thomas Hood
.br
This is free software; see the source for copying conditions.
.SH "SEE ALSO"
.BR interface-order (5),
.BR resolv.conf (5),
.BR resolver (3).
